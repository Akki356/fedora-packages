<div xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      id="${id}">     
      
  <form>
     <div> 
      <span>
        Group Membership
      </span>
      <input type="text" name="group" id="${id}_membership_entry"></input>
    </div>
    <div>
      <input class="button" type="submit" value="Request"/>
    </div>
  </form>
  <script type="text/javascript">
    var search_len = 1;
    var cache = {};
    var last_search = undefined; 
    var search_cb = function(text, result_cb)
      {
         var results = function(json)
           {
             var cache_key = undefined; 
             for (var i in json.groups)
               {
                 var dn = json.groups[i].display_name;
                 var n = json.groups[i].name;
                 var d = dn;
                 var cache_key = n.substr(0, search_len)

                 var item = [d, n];
                 
                 if (cache[cache_key] == 'loading')
                   cache[cache_key] = [];
                   
                 cache[cache_key].push(item);
               }
               
             if (last_search == cache_key)
                result_cb(cache[cache_key]);
           }
           
         search_chars = text.substr(0, search_len)
         last_search = search_chars;
         cached_list = cache[search_chars]
         if (!cached_list)
           {
             cache[search_chars] = 'loading';
             jQuery.getJSON('/proxy/fas/group_list', {'search': text[0] + '*',
                                                      'groups_only': true}, results);
           }
         else if (cached_list != 'loading')
           {
             result_cb(cached_list); 
           }
      }
      
    var autocomplete = new myfedora.ui.autocomplete_entry("${id}_membership_entry", 
                                                          search_len, 
                                                          search_cb);
  </script>
  
  <div class="list header-list">
    <h3>Memberships</h3>
    
    <div py:if="unapproved_memberships">
    <h4>Pending</h4>
    <table py:for="grouping_name in unapproved_memberships">
      <thead>
        <tr>
          <th>${grouping_name}</th>
        </tr>
      </thead>
      <tbody>
        <rowgroup py:for="group in unapproved_memberships[grouping_name]">
          <tr>
            <td>${group['display_name']}</td><td><a href="${group['url']}" target="_blank">Web Link Placeholder</a></td>
          </tr>
        </rowgroup>
      </tbody>
      
    </table>
    </div>
    <div>
    <h4>Approved</h4>
    <table py:for="grouping_name in approved_memberships">
      <thead>
        <tr>
          <th>${grouping_name}</th>
        </tr>
      </thead>
      <tbody>
        <rowgroup py:for="group in approved_memberships[grouping_name]">
          <tr>
            <td>${group['display_name']}</td><td><a href="${group['url']}" target="_blank">Web Link Placeholder</a></td><td py:if="group['user_can_remove']">Leave Group Placeholder</td>
          </tr>
        </rowgroup>
      </tbody>
      
    </table>
    </div>
  </div>
</div>
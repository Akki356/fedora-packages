<%!
    import tg
    from pylons import tmpl_context
%>

<div id="${id}" class="list header-list">

    % if builds_list:
        <h3>Builds</h3>
        ${children.pager.display(value_for(children.pager),
                                 **args_for(children.pager))}
        <table>
            <thead>
                <tr>
                    <th>Build ID</th>
                    <th>Name</th>
                    <th>Built By</th>
                    <th>Time</th>
                    <th>Finished</th>
                    <th>State</th>
                    <th>Release</th>
                </tr>
            </thead>
            % for i, build in enumerate(builds_list):
                <tbody>
                    <%
                        build_id=str(build['build_id'])
                        build_state=str(build['state'])
                        task_id=str(build['task_id'])
                        message_id='message_' + build_id
                        nvr=str(build['nvr'])
                        odd_or_even=i%2 and 'row-odd' or 'row-even'
                    %>
                    <tr class="${odd_or_even}">
                        <td>${build_id}</td>

                        <td id="${build_id}_name_col">
                            <%  menu_id='menu_' + build_id %>
                            <div class="${odd_or_even}">
                                <span class="package-name">
                                    <a href="http://koji.fedoraproject.org/koji/buildinfo?buildID=${build_id}" target="_blank">${nvr}</a>
                                </span>
                                <ul id="${menu_id}" class="hover_menu">
                                    <li><a href="http://koji.fedoraproject.org/koji/buildinfo?buildID=${build_id}" target="_blank">View package details in Koji</a></li>
                                </ul>
                                <script type="text/x-myfedora-extpoint">
                                    {
                                        'type': 'build_details',
                                        'placeholder_id': '${menu_id}',
                                        'build_id': '${build_id}',
                                        'task_id': '${task_id}',
                                        'package_nvr':'${nvr}',
                                        'build_state': ${build_state},
                                        'ui': 'hover_menu',
                                        'show_effect': 'slideDown("fast")',
                                        'hide_effect': 'slideUp("fast")',
                                        'run': 'whenReady'
                                    }
                                </script>
                            </div>
                        </td>
                        <td>
                            <% user = str(build['owner_name']) %>
                            <span class="person-name"><a href="${tg.url('/people/name/' + user + '/builds')}">${user}</a></span>
                        </td>
                        <td>${build['elapsed_build_time']}</td>
                        <td>
                            <div>
                                ${build['finished_line_0']}
                            </div>
                            <span class="timestamp">
                                ${build['finished_line_1']}
                            </span>
                        </td>
                        <td><img src="${str(build['mf_state_img'])}" /></td>
                        <% release_id='release_' + build_id %>
                        <td id="${release_id}">
                            &nbsp;
                            <% identity = (tmpl_context.identity and tmpl_context.identity.get('person', {}).get('username')) or '' %>
                            <script type="text/x-myfedora-extpoint">
                                {
                                    'type': 'release_info',
                                    'placeholder_id': '${release_id}',
                                    'build_id': '${build_id}',
                                    'package_nvr':'${nvr}',
                                    'build_state': ${build_state},
                                    'builder': '${build["owner_name"]}',
                                    'identity': '${identity}',
                                    'show_effect': 'fadeIn("slow")',
                                    'run': 'whenReady'
                                }
                            </script>
                        </td>
                    </tr>
                    <tr>

                        <td colspan="7"
                            id="${message_id}"
                            class="message_row">
                        </td>
                    </tr>
                </tbody>
            %endfor
        </table>
        ${children.pager.display(value_for(children.pager),
                                 **args_for(children.pager))}
     % else:

        <!-- used if there is no data -->
        % if packages:
            There are no build for the ${package} package
        % endif

        % if person:
            Fedora user ${person} has not built anything in the Fedora build systems
        % endif
    % endif
</div>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include href="../master.html"/>
<head>
<title>Package $package</title>
<script src="/static/js/jquery.js" type="text/javascript"></script>
<script src="/static/js/jquery.dimentions.js" type="text/javascript"></script>
</head>
<body>
    <h2>Package $package</h2>
    <script src="/static/js/myfedora.ui.js" type="text/javascript"></script>
    <script type="text/javascript">
      function render_release_tags(block, data, user_data)
      {
        var results = "";

        var tags = data.tags;
        for (var i in tags) {
           results += tags[i]['name'] + " "; 
        }
        return results;
      }
  
      function render_files_tags(block, data, user_data)
      {
        var results = "";

        var logs = data.files.logs;
        var downloads = data.files.downloads;



        results = files.toString();
        return results;
      }

      function render_message(block, data, user_data)
      {
        var results = "";

        var css_class = user_data["css_class"];
        block.addClass(css_class);
        block.parent().fadeIn('slow');

        log_url = data.log_url;
        log_name = data.log_name;

        results = "Error in build.  You can &lt;a target='_blank' href='" + log_url + "'&gt; refer to log " + log_name + " for more details&lt;/a&gt;";

        return results;
      }

    </script>
<div id="tabfloat">
<ul id="primary-links">
<span py:for="r in resource_urls"><li><a href="${package_url}/${r}">${r}</a></li> </span>
</ul>
</div>
  <div id="resource_content">
     <!-- TODO: CSS -->
     <form name="builds_navigation_form" action="${current_url}">
       <a onClick="document.builds_navigation_form.direction.value='prev'; document.builds_navigation_form.submit()" href="#" py:if="previous_disabled != 'disabled'">&lt;-- prev </a>
       <a onClick="document.builds_navigation_form.direction.value='next'; document.builds_navigation_form.submit()" href="#" py:if="next_disabled != 'disabled'">next --&gt; </a>
       <input type="hidden" name="offset" value="${offset}" />
       <input type="hidden" name="limit" value="${limit}" />
       <input type="hidden" name="direction" value="next"/>
     </form> 
     <table>
        <tr class="table_header1">
          <td class="table_header_col1">Build ID</td>
          <td class="table_header_col1">Name</td>
          <td class="table_header_col1">Build By</td>
          <td class="table_header_col1">Started</td>
          <td class="table_header_col1">Finished</td>
          <td class="table_header_col1">State</td>
          <td class="table_header_col1">Release</td>
        </tr>
        <span py:for="build in builds_list" 
              py:with="build_id=str(build['build_id']); build_state=str(build['state']); task_id=str(build['task_id'])">
        <tr>  
          <td>${build_id}</td>
          <!-- for now send to koji but we want a simpler page
               with the most common info organized nicely -->
          <td py:with="menu_id='menu_' + build_id" >
            <div onMouseOver="mf_menu_hover_start('${menu_id}')" 
                 onMouseOut="mf_menu_hover_stop()">
              <a href="https://koji.fedoraproject.org/koji/buildinfo?buildID=${build_id}" target="_blank">${str(build['nvr'])}</a>
              <div class="menu" id="${menu_id}" rowspan="4">
                <ul>
                  <li><a href="https://koji.fedoraproject.org/koji/buildinfo?buildID=${build_id}" target="_blank" >Details</a></li>
                  <span py:with="files_id = 'files_' + menu_id" id="${files_id}">
                     <script type="text/javascript">
                       $(document).ready(
                         function () {
                           /*mf_replace_block_async('${files_id}', 
                                                  '/mfquery/koji_files?task_id=${task_id}',
                                                  render_files_tags,
                                                  '');*/
                       });
                     </script>

                    <li py:with="logs_base_url='http://koji.fedoraproject.org/packages/' + package + '/' + build['version'] + '/' + build['release'] + '/data/logs'">
                      Logs
                        <ul>
                          <li><img src="/static/images/spinner-20.gif" /></li>
                        </ul>
                    </li>
                    <li py:if="build_state == '1'" py:with="dl_base_url='http://koji.fedoraproject.org/packages/' + package + '/' + build['version'] + '/' + build['release']">
                      Downloads
                        <ul>
                          <li><img src="/static/images/spinner-20.gif" /></li>
                        </ul>
                    </li>
                  </span>
                </ul>
              </div>
            </div> 
          </td>
          <td>${str(build['owner_name'])}</td>
          <td>${str(build['creation_time'])}</td>
          <td>${str(build['completion_time'])}</td>
          <td><img src="${str(build['mf_state_img'])}" /></td>
          <td 
              py:with="release_id='release_' + build_id"
              id="${release_id}">
            <span py:if="build_state=='1'">
              <script type="text/javascript">
                $(document).ready(
                function () {
                  mf_replace_block_async('${release_id}', 
                                         '/mfquery/koji_tags?build_id=${build_id}',
                                          render_release_tags,
                                          '');
                });
              </script>
              <img src="/static/images/spinner-20.gif" />
            </span>
          </td>
        </tr>
        <tr class="message_row">
          <td></td>
          <td colspan="6" 
              py:with="message_id='message_' + build_id"
              id="${message_id}">
            <span py:if="build_state=='3'">
              <script type="text/javascript">
                $(document).ready(
                function () {
                  mf_replace_block_async('${message_id}', 
                                         '/mfquery/koji_get_error_log?task_id=${task_id}',
                                          render_message,
                                          {'css_class':'error_message'});
                });
              </script>
            </span>
          </td>
        </tr>
        </span> 

     </table> 
  </div>
</body>
</html>
